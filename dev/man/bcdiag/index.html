<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plots and Tables · ROCKS.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://DaymondLing.github.io/ROCKS.jl/stable/man/bcdiag/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ROCKS.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">User&#39;s Guide</span><ul><li><a class="tocitem" href="../kstest/">KS Test</a></li><li><a class="tocitem" href="../roc/">ROC</a></li><li class="is-active"><a class="tocitem" href>Plots and Tables</a><ul class="internal"><li><a class="tocitem" href="#bcdiag"><span>bcdiag</span></a></li><li><a class="tocitem" href="#ksplot"><span>ksplot</span></a></li><li><a class="tocitem" href="#rocplot"><span>rocplot</span></a></li><li><a class="tocitem" href="#biasplot"><span>biasplot</span></a></li><li><a class="tocitem" href="#accuracyplot"><span>accuracyplot</span></a></li><li><a class="tocitem" href="#liftcurve"><span>liftcurve</span></a></li><li><a class="tocitem" href="#cumliftcurve"><span>cumliftcurve</span></a></li><li><a class="tocitem" href="#Tables"><span>Tables</span></a></li><li><a class="tocitem" href="#liftable"><span>liftable</span></a></li><li><a class="tocitem" href="#cumliftable"><span>cumliftable</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../Reference/">Function Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User&#39;s Guide</a></li><li class="is-active"><a href>Plots and Tables</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plots and Tables</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DaymondLing/ROCKS.jl/blob/master/docs/src/man/bcdiag.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Binary-Classifier-Diagnostics"><a class="docs-heading-anchor" href="#Binary-Classifier-Diagnostics">Binary Classifier Diagnostics</a><a id="Binary-Classifier-Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Binary-Classifier-Diagnostics" title="Permalink"></a></h1><p>While <code>kstest</code> and <code>roc</code> provide diagnostic measures for comparing model performance, we may want to produce graphs and tables to  document its performance, <code>bcdiag</code> allows us to do this easily.</p><pre><code class="language-julia">using ROCKS
using Random
using Distributions
using BenchmarkTools
Random.seed!(888)
const x = rand(Uniform(-5, 5), 1_000_000)
const logit = -3.0 .+ 0.5 .* x .+ rand(Normal(0, 0.1), length(x))
const prob = @. 1.0 / (1.0 + exp(-logit))
const target = rand(length(x)) .&lt;= prob</code></pre><p><code>kstest</code>:</p><pre><code class="language-julia">kstest(target, prob)</code></pre><pre class="documenter-example-output">(n = 1000000, n1 = 94410, n0 = 905590, baserate = 0.09441, ks = 0.49180459544452004, ksarg = 0.09004201376264864, ksdep = 0.362772)</pre><p><code>roc</code>:</p><pre><code class="language-julia">roc(target, prob)</code></pre><pre class="documenter-example-output">(conc = 69527841929, tied = 393224, disc = 15968516747, auc = 0.8132243271922474, gini = 0.6264486543844947)</pre><p>These functions are performant:</p><pre><code class="language-julia">@benchmark kstest($target, $prob)</code></pre><pre class="documenter-example-output">BechmarkTools.Trial: 34 samples with 1 evaluations.
 Range (min … max):  147.533 ms … 155.241 ms  ┊ GC (min … max): 0.00% … 0.52%
 Time  (median):     149.578 ms               ┊ GC (median):    0.52%
 Time  (mean ± σ):   150.325 ms ±   2.378 ms  ┊ GC (mean ± σ):  0.39% ± 0.31%

  ▃ █ ▃        ▃      ▃                    ▃     ▃▃              
  █▇█▇█▁▇▇▁▁▁▇▇█▇▇▇▁▇▇█▁▇▁▁▁▁▁▁▁▁▁▇▁▁▁▁▁▁▁▁█▁▁▁▁▇██▇▇▁▁▁▁▁▁▁▁▁▇ ▁
  148 ms           Histogram: frequency by time          155 ms &lt;

 Memory estimate: 46.02 MiB, allocs estimate: 19.</pre><pre><code class="language-julia">@benchmark roc($target, $prob)</code></pre><pre class="documenter-example-output">BechmarkTools.Trial: 51 samples with 1 evaluations.
 Range (min … max):  99.014 ms … 100.640 ms  ┊ GC (min … max): 0.00% … 0.00%
 Time  (median):     99.420 ms               ┊ GC (median):    0.00%
 Time  (mean ± σ):   99.535 ms ± 384.204 μs  ┊ GC (mean ± σ):  0.11% ± 0.30%

      ▁ ▄     █▄▄▄▄█ ▁▄ ▄  ▁                       ▁         ▁  
  ▆▁▁▁█▆█▁▆▆▁▆██████▆██▁█▁▁█▆▆▆▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▆▁▁▁▁▆▁█ ▁
  99 ms           Histogram: frequency by time          100 ms &lt;

 Memory estimate: 7.75 MiB, allocs estimate: 8.</pre><h2 id="bcdiag"><a class="docs-heading-anchor" href="#bcdiag">bcdiag</a><a id="bcdiag-1"></a><a class="docs-heading-anchor-permalink" href="#bcdiag" title="Permalink"></a></h2><p>In additional to numeric metrics, often we would like to have plots and tables as part of final model documentation. The <code>bcdiag</code> function allows easy generation of plots and tables.</p><p>Running <code>bcdiag</code> prints a quick summary:</p><pre><code class="language-julia">mdiag = bcdiag(target, prob)</code></pre><pre class="documenter-example-output">Base rate: 0.0944   n: 1000000   n1: 94410   n0: 905590
ks:        0.4918   occurs at value of 0.09004201376264864 depth of 0.362772
roc:       0.8132   concordant pairs: 69527841929   tied pairs: 393224   discordant pairs: 15968516747
Gini:      0.6264</pre><p>The output structure allows us to create the following plots and tables to understand:</p><ul><li>the ability of the model to separate the two classes</li><li>the accuracy of the probability point estimates</li><li>how to set cutoff for maximum accuracy</li><li>performance of the model at varying cutoff depth</li></ul><h2 id="ksplot"><a class="docs-heading-anchor" href="#ksplot">ksplot</a><a id="ksplot-1"></a><a class="docs-heading-anchor-permalink" href="#ksplot" title="Permalink"></a></h2><p><code>ksplot</code> plots the cumulative distribution of class 1 (true positive rate) and class 0 (false positive rate) versus depth.</p><pre><code class="language-julia">ksplot(mdiag)</code></pre><p>It shows where the maximum separation of the two distributions occur.</p><p><img src="../bcd-ksplot.png" alt/></p><h2 id="rocplot"><a class="docs-heading-anchor" href="#rocplot">rocplot</a><a id="rocplot-1"></a><a class="docs-heading-anchor-permalink" href="#rocplot" title="Permalink"></a></h2><p><code>rocplot</code> plots the true positive rate vs. false positive rate (depth is implicit).</p><pre><code class="language-julia">rocplot(mdiag)</code></pre><p>A perfect model has auc of 1, a random model has auc of 0.5.</p><p><img src="../bcd-rocplot.png" alt/></p><h2 id="biasplot"><a class="docs-heading-anchor" href="#biasplot">biasplot</a><a id="biasplot-1"></a><a class="docs-heading-anchor-permalink" href="#biasplot" title="Permalink"></a></h2><p>Both <code>ksplot</code> and <code>rocplot</code> rely on the ability of the model to rank order the observations, the score value itself doesn&#39;t matter. For example, if you took the score and perform any monotonic transform, <code>ks</code> and <code>auc</code> wouldn&#39;t change. There are occasions where the score value does matter, where the probabilities need to be accurate, for example, in expected return calculations. Thus, we need to understand whether the probabilities are accurate, <code>biasplot</code> does this by plotting the observed response rate versus predicted response rate to look for systemic bias. This is also called the <em>calibration</em> graph.</p><pre><code class="language-julia">biasplot(mdiag)</code></pre><p><img src="../bcd-biasplot.png" alt/></p><p>An unbiased model would lie on the diagnonal, systemic shift off the diagonal represents over or under estimate of the true probability.</p><h2 id="accuracyplot"><a class="docs-heading-anchor" href="#accuracyplot">accuracyplot</a><a id="accuracyplot-1"></a><a class="docs-heading-anchor-permalink" href="#accuracyplot" title="Permalink"></a></h2><p>People often refer to <strong>(TP + TN) / N</strong> as accuracy of the model, that is, the ability to correctly identify correct cases. It is used to compare model performance as well - model with higher accuracy is a better model. For a probability based classifier, a cutoff is required to turn probability to predicted class. So, what is the cutoff value to use to achieve maximum accuracy?</p><p>There are many approaches to setting the best cutoff, one way is to assign utility values to the four outcomes of [TP, FP, FN, TN] and maximize the sum across different cutoff&#39;s. Accuracy measure uses the utility values of [1, 0, 0, 1] giving TP + TN. You can assign negative penalty terms for misclassification as well.</p><p>Note that this is different from <code>kstest</code> - maximum separation on cumulative distribution (normalized to 100%) does not account for class size difference, e.g., class 1 may be only 2% of the cases.</p><pre><code class="language-julia">accuracyplot(mdiag)</code></pre><p><img src="../bcd-accuracyplot.png" alt/></p><h2 id="liftcurve"><a class="docs-heading-anchor" href="#liftcurve">liftcurve</a><a id="liftcurve-1"></a><a class="docs-heading-anchor-permalink" href="#liftcurve" title="Permalink"></a></h2><p><code>liftcurve</code> plots the actual response and predicted response versus depth, with baserate as 1.</p><pre><code class="language-julia">liftcurve(mdiag)</code></pre><p>We can easily see where the model is performing better than average, approximately the same as average, or below average.</p><p><img src="../bcd-liftcurve.png" alt/></p><h2 id="cumliftcurve"><a class="docs-heading-anchor" href="#cumliftcurve">cumliftcurve</a><a id="cumliftcurve-1"></a><a class="docs-heading-anchor-permalink" href="#cumliftcurve" title="Permalink"></a></h2><p><code>cumliftcurve</code> is similar to <code>liftcurve</code>, the difference is it is a plot of <em>cumulative</em> response rate from the top of the model.</p><pre><code class="language-julia">cumliftcurve(mdiag)</code></pre><p><img src="../bcd-cumliftcurve.png" alt/></p><h2 id="Tables"><a class="docs-heading-anchor" href="#Tables">Tables</a><a id="Tables-1"></a><a class="docs-heading-anchor-permalink" href="#Tables" title="Permalink"></a></h2><p><code>bcdiag</code> uses 100 as the default number of groups, this is good for generating plots above.</p><p>For tables such as decile reports, we may want to run <code>bcdiag</code> with only 10 groups and then generate the tables:</p><pre><code class="language-julia">mdiag10 = bcdiag(target, prob; groups = 10)</code></pre><pre class="documenter-example-output">Base rate: 0.0944   n: 1000000   n1: 94410   n0: 905590
ks:        0.4918   occurs at value of 0.09004201376264864 depth of 0.362772
roc:       0.8132   concordant pairs: 69527841929   tied pairs: 393224   discordant pairs: 15968516747
Gini:      0.6264</pre><h2 id="liftable"><a class="docs-heading-anchor" href="#liftable">liftable</a><a id="liftable-1"></a><a class="docs-heading-anchor-permalink" href="#liftable" title="Permalink"></a></h2><p><code>liftable</code> is the table from which <code>liftcurve</code> is plotted.</p><pre><code class="language-julia">liftable(mdiag10)</code></pre><table class="data-frame"><thead><tr><th></th><th>grp</th><th>depth</th><th>count</th><th>cntObs</th><th>cntPrd</th><th>rrObs</th><th>rrPred</th><th>liftObs</th><th>liftPrd</th></tr><tr><th></th><th>Int32</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>10 rows × 9 columns</p><tr><th>1</th><td>0</td><td>0.1</td><td>100000</td><td>32486</td><td>32362.6</td><td>0.32486</td><td>0.323626</td><td>3.44095</td><td>3.42787</td></tr><tr><th>2</th><td>1</td><td>0.2</td><td>100000</td><td>22260</td><td>22327.0</td><td>0.2226</td><td>0.22327</td><td>2.3578</td><td>2.3649</td></tr><tr><th>3</th><td>2</td><td>0.3</td><td>100000</td><td>14934</td><td>14899.3</td><td>0.14934</td><td>0.148993</td><td>1.58182</td><td>1.57815</td></tr><tr><th>4</th><td>3</td><td>0.4</td><td>100000</td><td>9720</td><td>9610.26</td><td>0.0972</td><td>0.0961026</td><td>1.02955</td><td>1.01793</td></tr><tr><th>5</th><td>4</td><td>0.5</td><td>100000</td><td>6050</td><td>6059.78</td><td>0.0605</td><td>0.0605978</td><td>0.640822</td><td>0.641858</td></tr><tr><th>6</th><td>5</td><td>0.6</td><td>100000</td><td>3736</td><td>3767.23</td><td>0.03736</td><td>0.0376723</td><td>0.395721</td><td>0.399028</td></tr><tr><th>7</th><td>6</td><td>0.7</td><td>100000</td><td>2386</td><td>2321.27</td><td>0.02386</td><td>0.0232127</td><td>0.252727</td><td>0.245872</td></tr><tr><th>8</th><td>7</td><td>0.8</td><td>100000</td><td>1421</td><td>1421.43</td><td>0.01421</td><td>0.0142143</td><td>0.150514</td><td>0.150559</td></tr><tr><th>9</th><td>8</td><td>0.9</td><td>100000</td><td>880</td><td>866.2</td><td>0.0088</td><td>0.008662</td><td>0.0932105</td><td>0.0917488</td></tr><tr><th>10</th><td>9</td><td>1.0</td><td>100000</td><td>537</td><td>522.95</td><td>0.00537</td><td>0.0052295</td><td>0.0568796</td><td>0.0553914</td></tr></tbody></table><h2 id="cumliftable"><a class="docs-heading-anchor" href="#cumliftable">cumliftable</a><a id="cumliftable-1"></a><a class="docs-heading-anchor-permalink" href="#cumliftable" title="Permalink"></a></h2><p><code>cumliftable</code> is the <em>cumulative</em> version of <code>liftable</code>.</p><pre><code class="language-julia">cumliftable(mdiag10)</code></pre><table class="data-frame"><thead><tr><th></th><th>grp</th><th>depth</th><th>count</th><th>cumObs</th><th>cumPrd</th><th>crObs</th><th>crPrd</th><th>liftObs</th><th>liftPrd</th></tr><tr><th></th><th>Int32</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>10 rows × 9 columns</p><tr><th>1</th><td>0</td><td>0.1</td><td>100000</td><td>32486</td><td>32362.6</td><td>0.32486</td><td>0.323626</td><td>3.44095</td><td>3.42787</td></tr><tr><th>2</th><td>1</td><td>0.2</td><td>200000</td><td>54746</td><td>54689.6</td><td>0.27373</td><td>0.273448</td><td>2.89938</td><td>2.89639</td></tr><tr><th>3</th><td>2</td><td>0.3</td><td>300000</td><td>69680</td><td>69588.8</td><td>0.232267</td><td>0.231963</td><td>2.46019</td><td>2.45697</td></tr><tr><th>4</th><td>3</td><td>0.4</td><td>400000</td><td>79400</td><td>79199.1</td><td>0.1985</td><td>0.197998</td><td>2.10253</td><td>2.09721</td></tr><tr><th>5</th><td>4</td><td>0.5</td><td>500000</td><td>85450</td><td>85258.9</td><td>0.1709</td><td>0.170518</td><td>1.81019</td><td>1.80614</td></tr><tr><th>6</th><td>5</td><td>0.6</td><td>600000</td><td>89186</td><td>89026.1</td><td>0.148643</td><td>0.148377</td><td>1.57444</td><td>1.57162</td></tr><tr><th>7</th><td>6</td><td>0.7</td><td>700000</td><td>91572</td><td>91347.4</td><td>0.130817</td><td>0.130496</td><td>1.38563</td><td>1.38223</td></tr><tr><th>8</th><td>7</td><td>0.8</td><td>800000</td><td>92993</td><td>92768.8</td><td>0.116241</td><td>0.115961</td><td>1.23124</td><td>1.22827</td></tr><tr><th>9</th><td>8</td><td>0.9</td><td>900000</td><td>93873</td><td>93635.0</td><td>0.104303</td><td>0.104039</td><td>1.10479</td><td>1.10199</td></tr><tr><th>10</th><td>9</td><td>1.0</td><td>1000000</td><td>94410</td><td>94158.0</td><td>0.09441</td><td>0.094158</td><td>1.0</td><td>0.99733</td></tr></tbody></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../roc/">« ROC</a><a class="docs-footer-nextpage" href="../../Reference/">Function Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 15 August 2022 18:15">Monday 15 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
